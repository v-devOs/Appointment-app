// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum StatusPayment {
  ACEPTED
  CANCELED
  DECLINED
  PENDING
}

enum SubscriptionStatus {
  ACTIVE
  PENDING_PAYMENT
  CANCELED
}

enum TypeUser {
  ADMIN
  OWNER_BUSSINES
  EMPLOYEE
}

enum StatusAppointment {
  PENDING
  CANCELED
  ATTENDED
  NO_ATTENDED
}

model Payment {
  id            String @id @default(uuid())
  amount        Float
  discount      Float
  datePayment   DateTime
  status        StatusPayment

  subscriptionDetails SubscriptionDetails[]
  personalBusinessDetails PersonalBusinessDetails[]
}

model User {
  id            String @id @default(uuid())
  email         String @unique
  password      String 
  typeUser      TypeUser @default(OWNER_BUSSINES)

  personal Personal?
}

model Subscription {
  id                       String @id @default(uuid())
  amount                   Float @default(299.99)
  status                   SubscriptionStatus @default(PENDING_PAYMENT)
  createdAt                DateTime @default(now())
  dateStartCurrentPeriod   DateTime
  dateEndCurrentPeriod     DateTime

  subscriptionDetails SubscriptionDetails[]
}

model Journal {
  id            String @id @default(uuid())
  hourStart     DateTime
  hourEnd       DateTime
  freeTime      DateTime
  startAbsence  DateTime
  endAbsence    DateTime

  personals Personal[]
}

model Business {
  id           String @id @default(uuid())
  name         String
  tel          String?
  email        String?
  direction    String
  hourOpen     DateTime
  hourClose    DateTime

  personalBusinessDetails PersonalBusinessDetails[]
  employees    Personal[]
  typeAppointments TypeAppointment[]
  clients      Client[]
}

model Personal {
  id           String @id @default(uuid())

  // Relations
  userid       String @unique
  businessid   String
  journalid    String

  user         User  @relation(fields: [userid], references: [id])
  journal      Journal @relation(fields: [journalid], references: [id])
  business     Business @relation(fields: [businessid], references: [id])

  firstName    String
  secondName   String?
  lastNameP    String
  lastNameM    String?
  tel          String 

  subscriptionDetails SubscriptionDetails[]
  personalBusinessDetails PersonalBusinessDetails[]
  appointments Appointment[]
}

model TypeAppointment {
  id               String @id @default(uuid())
  typeAppointment  String
  description      String?

  // Relations
  businessid       String
  business         Business @relation(fields: [businessid], references: [id])

  appointments     Appointment[]
}

model Appointment {
  id                 String @id @default(uuid())
  status             StatusAppointment
  date               DateTime
  estimatedDuration  Float
  realDuration       Float

  // Relations
  clientid           String
  typeAppointmentid  String
  personalid         String

  client             Client @relation(fields: [clientid], references: [id])
  typeAppointment    TypeAppointment @relation(fields: [typeAppointmentid], references: [id])
  personal           Personal @relation(fields: [personalid], references: [id])
}

model Client {
  id           String @id @default(uuid())
  firstName    String
  secondName   String?
  lastNameP    String
  lastNameM    String?
  tel          String 

  // Relations
  businessid   String
  business     Business @relation(fields: [businessid], references: [id])

  appointments Appointment[]
}

// Auxiliar Tables
// 1. Manage the historial of the payments made by the owner
model SubscriptionDetails { 
  id              String @id @default(uuid())

  // Relations
  subscriptionid  String
  paymentid       String
  personalid      String

  subscription   Subscription @relation(fields: [subscriptionid], references: [id]) 
  payment        Payment @relation(fields: [paymentid], references: [id])
  personal       Personal @relation(fields: [personalid], references: [id])
}

model PersonalBusinessDetails {
  id             String @id @default(uuid())

  // Relations
  personalid    String
  businessid    String
  paymentid     String

  personal      Personal @relation(fields: [personalid], references: [id])
  business      Business @relation(fields: [businessid], references: [id])
  payment       Payment @relation(fields: [paymentid], references: [id])
}