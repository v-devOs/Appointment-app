// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum StatusPayment {
  ACEPTED
  CANCELED
  DECLINED
  PENDING
}

enum SubscriptionStatus {
  ACTIVE
  PENDING_PAYMENT
  CANCELED
}

enum TypeUser {
  ADMIN
  OWNER_BUSSINES
  EMPLOYEE
}

enum StatusAppointment {
  PENDING
  CANCELED
  ATTENDED
  NO_ATTENDED
}

model Payment {
  id            Int @id @default(autoincrement())
  amount        Float
  discount      Float
  datePayment   DateTime
  status        StatusPayment

  subscriptionDetails SubscriptionDetails[]
  personalBusinessDetails PersonalBusinessDetails[]
}

model User {
  id            Int @id @default(autoincrement())
  email         String @unique
  password      String 
  typeUser      TypeUser @default(OWNER_BUSSINES)

  personal Personal?
}

model Subscription {
  id                       Int @id @default(autoincrement())
  amount                   Float @default(299.99)
  status                   SubscriptionStatus @default(PENDING_PAYMENT)
  createdAt                DateTime @default(now())
  dateStartCurrentPeriod   DateTime
  dateEndCurrentPeriod     DateTime

  subscriptionDetails SubscriptionDetails[]
}

model Journal {
  id            Int @id @default(autoincrement())
  hourStart     String
  hourEnd       String
  freeTime      String
  startAbsence  DateTime
  endAbsence    DateTime
  durationFreeTime Int // Durations of the free time for the brear

  personals Personal[]
}

model Business {
  id           Int @id @default(autoincrement())
  name         String
  tel          String?
  email        String?
  direction    String
  hourOpen     String
  hourClose    String

  personalBusinessDetails PersonalBusinessDetails[]
  employees    Personal[]
  typeAppointments TypeAppointment[]
  clients      Client[]
}

model Personal {
  id           Int @id @default(autoincrement())

  // Relations
  userid       Int @unique
  businessid   Int
  journalid    Int

  user         User  @relation(fields: [userid], references: [id])
  journal      Journal @relation(fields: [journalid], references: [id])
  business     Business @relation(fields: [businessid], references: [id])

  firstName    String
  secondName   String?
  lastNameP    String
  lastNameM    String?
  tel          String 

  subscriptionDetails SubscriptionDetails[]
  personalBusinessDetails PersonalBusinessDetails[]
  appointments Appointment[]
}

model TypeAppointment {
  id               Int @id @default(autoincrement())
  typeAppointment  String
  description      String?

  // Relations
  businessid       Int
  business         Business @relation(fields: [businessid], references: [id])

  appointments     Appointment[]
}

model Appointment {
  id                 Int @id @default(autoincrement())
  status             StatusAppointment
  date               DateTime
  estimatedDuration  Float
  realDuration       Float

  // Relations
  clientid           Int
  typeAppointmentid  Int
  personalid         Int

  client             Client @relation(fields: [clientid], references: [id])
  typeAppointment    TypeAppointment @relation(fields: [typeAppointmentid], references: [id])
  personal           Personal @relation(fields: [personalid], references: [id])
}

model Client {
  id           Int @id @default(autoincrement())
  firstName    String
  secondName   String?
  lastNameP    String
  lastNameM    String?
  tel          String 

  // Relations
  businessid   Int
  business     Business @relation(fields: [businessid], references: [id])

  appointments Appointment[]
}

// Auxiliar Tables
// 1. Manage the historial of the payments made by the owner
model SubscriptionDetails { 
  id              Int @id @default(autoincrement())

  // Relations
  subscriptionid  Int
  paymentid       Int
  personalid      Int

  subscription   Subscription @relation(fields: [subscriptionid], references: [id]) 
  payment        Payment @relation(fields: [paymentid], references: [id])
  personal       Personal @relation(fields: [personalid], references: [id])
}

model PersonalBusinessDetails {
  id             Int @id @default(autoincrement())

  // Relations
  personalid    Int
  businessid    Int
  paymentid     Int

  personal      Personal @relation(fields: [personalid], references: [id])
  business      Business @relation(fields: [businessid], references: [id])
  payment       Payment @relation(fields: [paymentid], references: [id])
}