// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// Enums
enum Status {
  ACTIVE
  NO_ACTIVE
}
enum StatusPayment {
  ACEPTED
  CANCELED
  DECLINED
  PENDING
}

enum StatusSubscription {
  ACTIVE
  PENDING_PAYMENT
  CANCELED
}

enum TypeUser {
  ADMIN
  OWNER_BUSSINES
  EMPLOYEE
}

enum StatusAppointment {
  PENDING
  CANCELED
  ATTENDED
  NO_ATTENDED
}
// Models
model Journal {
  id Int @id @default(autoincrement())
  hourStart DateTime
  hourEnd   DateTime
  freeTime  DateTime
  durationFreeTime Int
  startAbsence DateTime
  endAbsence DateTime

  personals Personal[]
}

model User {
  id Int @id @default(autoincrement())
  email String @unique
  password String

  status Status @default(ACTIVE)

  personals Personal[]
  businesses Business[]

  subscriptionDetails SubscriptionDetails[]
}

model Business {
  id Int @id @default(autoincrement())
  name String
  tel String?
  email String?
  direction String?
  hourOpen DateTime
  hourClose DateTime

  status Status @default(ACTIVE)

  // Relations
  ownerid Int
  owner User @relation(fields: [ownerid], references: [id])
  personals Personal[]

  clients Client[]

  typeAppointments TypeAppointment[]

  appointmentDetails AppointmentDetails[]
}

model Payment {
  id Int @id @default(autoincrement())
  amount Float @default(0.00)
  discount Float? @default(0.00)
  datePayment DateTime
  comentaries String?
  status StatusPayment

  subscriptionDetails SubscriptionDetails[]
}

model Client {
  id Int @id @default(autoincrement())
  firstName String
  secondName String?
  lastNameP String
  lastNameM String?
  tel String

  // Relations
  businessid Int

  business Business @relation(fields: [businessid], references: [id])


  appointmentDetails AppointmentDetails[]
}

model Subscription {
  id Int @id @default(autoincrement())
  amount Float @default(239.99)
  dateStartCurrentPeriod DateTime @default(now())
  dateEndCurrentPeriod DateTime
  status StatusSubscription
  createdAt DateTime @default(now())

  subscriptionDetails SubscriptionDetails[]
}

model Personal {
  id Int @id @default(autoincrement())
  firstName String
  secondName String?
  lastNameP String
  lastNameM String?
  tel String
  typePersonal TypeUser
  status Status @default(ACTIVE)

  // Relations
  userid Int
  businessid Int
  journalid Int?

  user User @relation(fields: [userid], references: [id])
  business Business @relation(fields: [businessid], references: [id])
  journal Journal? @relation(fields: [journalid], references: [id])

  appointmentDetails AppointmentDetails[]
}

model TypeAppointment {
  id Int @id @default(autoincrement())
  typeAppointment String
  description String?

  status Status @default(ACTIVE)

  // Relations
  businessid Int
  business Business @relation(fields: [businessid], references: [id])

  appointmentDetails AppointmentDetails[]
}

model SubscriptionDetails {
  id Int @id @default(autoincrement())
  // Referencias
  subscriptionid Int
  paymentid Int
  userid Int

  subscription Subscription @relation(fields: [subscriptionid], references: [id])
  payment Payment @relation(fields: [paymentid], references: [id])
  user User @relation(fields: [userid], references: [id])
}
model AppointmentComments {
  id Int @id @default(autoincrement())
  comment String? 
  createdAt DateTime @default(now())

  appointmentDetailsid Int?
  appointmentDetails AppointmentDetails? @relation(fields: [appointmentDetailsid], references: [id])
}
model AppointmentDetails {
  id Int @id @default(autoincrement())

  date DateTime
  status StatusAppointment
  estimatedDuration Int
  realDuration Int

  hourStart DateTime
  hourEnd DateTime

  // Relations
  personalid Int?
  businessid Int?
  typeAppointmentid Int?
  clientid Int?

  personal Personal? @relation(fields: [personalid], references: [id])
  business Business? @relation(fields: [businessid], references: [id])
  typeAppointment TypeAppointment? @relation(fields: [typeAppointmentid], references: [id]) 
  client Client? @relation(fields: [clientid], references: [id])

  appointmentComments AppointmentComments[]
}

